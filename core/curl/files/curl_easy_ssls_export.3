.\" generated by cd2nroff 0.1 from curl_easy_ssls_export.md
.TH curl_easy_ssls_export 3 "2025-02-12" libcurl
.SH NAME
curl_easy_ssls_export \- export SSL sessions
.SH SYNOPSIS
.nf
#include <curl/curl.h>

typedef CURLcode curl_ssls_export_function(CURL *handle,
                                           void *userptr,
                                           const char *session_key,
                                           const unsigned char *shmac,
                                           size_t shmac_len,
                                           const unsigned char *sdata,
                                           size_t sdata_len,
                                           curl_off_t valid_until,
                                           int ietf_tls_id,
                                           const char *alpn,
                                           size_t earlydata_max);

CURLcode curl_easy_ssls_export(CURL *handle,
                               curl_ssls_export_function *export_fn,
                               void *userptr);
.fi
.SH DESCRIPTION
This function iterates over all SSL session tickets that belong to the
easy handle and invokes the \fBexport_fn\fP callback on each of them, as
long as the callback returns \fBCURLE_OK\fP.

The callback may then store this information and use \fIcurl_easy_ssls_import(3)\fP
in another libcurl instance to add SSL session tickets again. Reuse of
SSL session tickets may result in faster handshakes and some connections
might be able to send request data in the initial packets (0\-RTT).

From all the parameters passed to the \fBexport_fn\fP only two need to be
persisted: either \fBsession_key\fP or \fBshamc\fP and always \fBsdata\fP. All
other parameters are informative, e.g. allow the callback to act only
on specific session tickets.

Note that SSL sessions that involve a client certificate or SRP
username/password are not exported.
.SH Export Function Parameter
.IP "Session Key"
This is a printable, 0\-terminated string that starts with \fBhostname:port\fP
the session ticket is originating from and also contains all relevant
SSL parameters used in the connection. The key also carries the name
and version number of the TLS backend used.

It is recommended to only persist \fBsession_key\fP when it can be protected
from outside access. Since the hostname appears in plain text, it would
allow any third party to see how curl has been used for.
.IP "Salted Hash"
A binary blob of \fBshmac_len\fP bytes that contains a random salt and
a cryptographic hash of the salt and \fBsession_key\fP. The salt is generated
for every session individually. Storing \fBshmac\fP is recommended when
placing session tickets in a file, for example.

A third party may brute\-force known hostnames, but cannot just "grep" for
them.
.IP "Session Data"
A binary blob of \fBsdata_len\fP bytes, \fBsdata\fP contains all relevant
SSL session ticket information for a later import \- apart from \fBsession_key\fP
and \fBshmac\fP.
.IP valid_until
Seconds since EPOCH (1970\-01\-01) until the session ticket is considered
valid.
.IP "TLS Version"
The IETF assigned number for the TLS version the session ticket originates
from. This is \fB0x0304\fP for TLSv1.3, \fB0x0303\fP for 1.2, etc. Session
tickets from version 1.3 have better security properties, so an export
might store only those.
.IP ALPN
The ALPN protocol that had been negotiated with the host. This may be
\fBNULL\fP if negotiation gave no result or had not been attempted.
.IP "Early Data"
The maximum amount of bytes the server supports to receive in early data
(0\-RTT). This is 0 unless the server explicitly indicates support.
.SH PROTOCOLS
This functionality affects all TLS based protocols: HTTPS, FTPS, IMAPS, POP3S, SMTPS etc.

This option works only with the following TLS backends:
BearSSL, GnuTLS, OpenSSL, mbedTLS and wolfSSL
.SH EXAMPLE
.nf
CURLcode my_export_cb(CURL *handle,
                      void *userptr,
                      const char *session_key,
                      const unsigned char *shmac,
                      size_t shmac_len,
                      const unsigned char *sdata,
                      size_t sdata_len,
                      curl_off_t valid_until,
                      int ietf_tls_id,
                      const char *alpn,
                      size_t earlydata_max)
{
  /* persist sdata */
  return CURLE_OK;
}

int main(void)
{
  CURLSHcode sh;
  CURLSH *share = curl_share_init();
  CURLcode rc;
  CURL *curl;

  sh = curl_share_setopt(share, CURLSHOPT_SHARE, CURL_LOCK_DATA_SSL_SESSION);
  if(sh)
    printf("Error: %s\\n", curl_share_strerror(sh));

  curl = curl_easy_init();
  if(curl) {
    curl_easy_setopt(curl, CURLOPT_SHARE, share);

    rc = curl_easy_ssls_export(curl, my_export_cb, NULL);

    /* always cleanup */
    curl_easy_cleanup(curl);
  }
  curl_share_cleanup(share);
}
.fi
.SH AVAILABILITY
Added in curl 8.12.0
.SH RETURN VALUE
This function returns a CURLcode indicating success or error.

CURLE_OK (0) means everything was OK, non\-zero means an error occurred, see
\fIlibcurl\-errors(3)\fP. If \fICURLOPT_ERRORBUFFER(3)\fP was set with \fIcurl_easy_setopt(3)\fP
there can be an error message stored in the error buffer when non\-zero is
returned.
.SH SEE ALSO
.BR CURLOPT_SHARE (3),
.BR curl_easy_ssls_import (3),
.BR curl_share_setopt (3)
